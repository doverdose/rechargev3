<% layout('../layouts/default') -%>

<div class="page-header">
	<h2>Provider administration</h2>
</div>

<div class="row stats">
	<div class="col-xs-6">
		<h3>Your patients</h3>
	</div>
	<div class="col-xs-6 text-right">
		<button class="btn btn-default" rel="popover" data-placement="top" data-tpl=".js-usersearch-template">
			<i class="glyphicon glyphicon-plus"></i>
			Add patient
		</button>
	</div>
</div>

<% for(var i = 0; i < yourPatients.length; i++) { %>
	<div class="row stats">
		<div class="col-xs-4">
			<a href="/user/<%= yourPatients[i].id %>" style='line-height: 35px;'>
				<%= yourPatients[i].name %>
			</a>
		</div>
		<div class="col-xs-6 text-right">
			<form action="/user/assign" method="post">
				<input type="hidden" name="_csrf" value="<%= csrf_token %>">
				<input type="hidden" name="providerId" id="providerId" value="<%= user.id %>">
				<input type="hidden" name="userId" id="userId" value="<%= yourPatients[i].id %>">

				<select name='surveyId' class="form-control" style='float: left;width: 150px;'>
          <% for(var j=0; j < surveys.length; j++) { %>
				  <option value="<%= surveys[j].id %>"> <%= surveys[j].title %> </option>
          <% } %>
				</select>

				<button type="submit" class="btn btn-primary">Assign survey</button>
			</form>
		</div>
		<div class="col-xs-2 text-right">
			<form action="/provider/user/remove" method="post">
				<input type="hidden" name="_csrf" value="<%= csrf_token %>">
				<input type="hidden" name="providerId" id="providerId" value="<%= user.id %>">
				<input type="hidden" name="userId" id="userId" value="<%= yourPatients[i].id %>">

				<button type="submit" class="btn btn-default">X</button>
			</form>
		</div>
	</div>
<% } %>

<% if(!yourPatients.length) { %>
	<h4 class="text-muted text-center">You have no patients. </h4>
<% } %>

<div class="js-template js-usersearch-template">
	<form action="/provider/user/add" method="post">
		<input type="hidden" name="_csrf" value="<%= csrf_token %>">
		<input type="hidden" name="providerId" id="providerId" value="<%= user.id %>">

		<div class="form-group">
			<label for="userId">Search for users</label>
			<select class="js-select2" id="userId" name="userId">
				<% for(var i = 0; i < patients.length; i++) { %>
					<option value="<%= patients[i].id %>"><%= patients[i].name %></option>
				<% } %>
			</select>
		</div>

		<button type="submit" class="btn btn-primary btn-block">
			Add
		</button>
	</form>
</div>
